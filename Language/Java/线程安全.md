# Threadsafe
A data type or static method is _threadsafe_ if it *behaves correctly when used from multiple threads, regardless of how those threads are executed, and without demanding additional coordination from the calling code*.
当多个线程访问某个类时，不管运行时环境采用何种调度方式或线程将如何交替执行，且在主调代码中

-  “Behaves correctly” ： satisfying its specification and preserving its response invariant.
-   “Regardless of how threads are executed” ： threads might be on multiple processors or timesliced on the same processor.
-   And “without additional coordination” ： that the data type can’t put preconditions on its caller related to timing, like “you can’t call `get()` while `set()` is in progress.”

For example,  [`Iterator`](http://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/Iterator.html)。
It’s not threadsafe when used with a mutable collection. `Iterator`’s specification says that you can’t modify a collection at the same time as you’re iterating over it (except using the iterator’s own `remove` method). That’s a timing-related precondition put on the caller, and `Iterator` makes no guarantee to behave correctly if you violate it.


# 安全性

-   **可见性** - 线程修改了某个共享变量，其状态能够立即被其他线程知晓。通常被解释为将线程本地状态反映到主内存上，`volatile` 就是负责保证可见性的。
-   **原子性** - 多个操作要么全部成功要么全部失败。一般通过同步机制（加锁：`sychronized`、`Lock`）实现。
-   **有序性** - 是保证线程内串行语义，避免指令重排等。

