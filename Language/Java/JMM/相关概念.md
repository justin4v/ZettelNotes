# Shared variables/Heap memory
- Memory that **can be shared between threads is called shared or heap memory**.
- All instance fields, static fields and array elements are stored in heap memory. 
- We use the term *variable*  to refer to both fields and array elements. 
- *Variables local to a method are never shared between threads*.

# Inter-thread Actions
- An inter-thread action is **an action performed by a thread that could be detected by or be directly influenced by another thread**. 
- **Inter-thread actions include reads and writes of shared variables and synchronization actions**, such as locking or unlocking a monitor, reading or writing a volatile variable, or starting a thread.

# Program Order
Among all the inter-thread actions performed by each thread t, **the program order of *t* is a total order that reflects the order in which these actions would be performed according to the intra-thread semantics of *t***.

# Intra-thread semantics
Intra-thread semantics are the standard semantics for single threaded programs, and allow the complete prediction of the behavior of a thread based on the values seen by read actions within the thread.

Simply put, **intra-thread semantics are what determine the execution of a thread in isolation**.

# Synchronization Actions
- **All inter-thread actions other than reads and writes of normal and final variables are synchronization actions**. 
- These *include locks, unlocks, reads of and writes to volatile variables, actions that start a thread, and actions that detect that a thread is done*.

# Synchronization Order 
In any execution, there is a **synchronization order which is a total order over all of the synchronization actions of that execution.** 

For each thread t, the synchronization order of the synchronization actions in t is consistent with the program order of t.

# Happens-Before Edges
If we have two actions x and y, we **use $$x{\overset{hb}{\longrightarrow}}y$$ to mean that x happens before y**.
If x and y are actions of the same thread and x comes before y in program order, then $$x{\overset{hb}{\longrightarrow}}y$$

Synchronization actions also induce *happens-before edges*. We call the resulting edges--*synchronized-with edges*, and they are defined as follows:
- There is a happens-before edge from **an unlock action on monitor *m* to all subsequent lock actions on *m*(where subsequent is defined according to the synchronization order). **
- There is a happens-before edge from **a write to a volatile variable *v* to all subsequent reads of *v* by any thread (where subsequent is defined according to the synchronization order).** 
- There is a happens-before edge from **an action that starts a thread to the first action in the thread it starts. **
- There is a happens-before edge **between the final action in a thread T1 and an action in another thread T2 that detects that T1 has terminated.** T2 may accomplish this by calling T1.isAlive() or doing a join action on T1. 
- If thread T1 interrupts thread T2, there is a happens-before edge from **the interrupted by T1 to the point where any other thread (including T2) determines the T2 has been interrupted** (by having an InterruptedException thrown or by invoking Thread.interruped or Thread.isInterrupted). 


In addition, we have two other rules for *generating happens-before edges*. 
- There is a happens-before edge **from the write of the default value (zero, false or null) of each variable to the first action in every thread.** 
- Happens-before is transitively closed. In other words, if $$x{\overset{hb}{\longrightarrow}}y$$ and $$y{\overset{hb}{\longrightarrow}}z$$, then $$x{\overset{hb}{\longrightarrow}}z$$.


It should be noted that *the presence of a happens-before relationship between two actions does not necessarily imply that they have to take place in that order in an implementation*.

However, they have to appear to share an ordering to the rest of the program. If it cannot be caught, it is not illegal. 

For example, the write of a default value to every field of an object constructed by a thread need not occur before the beginning of that thread, as long as no read ever observes that fact.
