#Thread-safe #Thread #Todo 


#  不是"线程的安全"
- **“线程安全”** *不是指线程的安全*，而是指**内存数据的安全**。
- 目前主流操作系统都是多任务的，即多个进程同时运行。进程的内存空间中*有 Heap 堆（内存）*，Heap 进程中**线程共享**。
- 假设线程 A 处理数据（Heap 中）到一半阻塞，调度器调度线程 B 执行。当 A 再次执行时，发现 Heap 中*原有数据已被修改，不是预期数据*。线程 A 看来，数据不是安全的。 
- 比如小区看作一个进程，小区里的道路/绿化属于公共区域。你拿1万块钱往地上一扔，回家睡觉。睡醒后你打算去把它捡回来，发现钱已经不见了。  公共区域人来人往，你放的东西在*没有看管措施时，一定是不安全的*。
  
所以**线程安全**指：
> 堆内存中的数据可以被任何线程访问，在没有限制的情况下**存在被意外修改的风险**。  

- 堆内存空间在*没有保护机制的情况下，对多线程来说是不安全的*，放进去的数据，可能被别的线程“破坏”。

# 保证线程安全

解决线程安全问题的过程其实是一个取舍的过程，不同的解决方案有不同的侧重点

## 私有的东西就不该让别人知道
现实中很多人都会把1万块钱藏着掖着，不让无关的人知道，所以根本不可能扔到大马路上。因为这钱是你的私有物品。  
  
在程序中也是这样的，所以操作系统会为每个线程分配属于它自己的内存空间，通常称为栈内存，其它线程无权访问。这也是由操作系统保障的。  
  
如果一些数据只有某个线程会使用，其它线程不能操作也不需要操作，这些数据就可以放入线程的栈内存中。较为常见的就是局部变量。






# 参考
1. [如果你这样回答“什么是线程安全”，面试官都会对你刮目相看](https://www.cnblogs.com/lixinjie/p/a-answer-about-thread-safety-in-a-interview.html#!comments)