#Concurrent #Concurrent-programming #Todo 

# 可见性问题
```java
public class ConcurrentDemo {
    // static 变量，存储于 Heap 区：JVM 进程中的所有线程共享区域
	private static Boolean initFlag=false;
	
	public static void main(String[] args) throws InterruptedException {
		
		Thread t1 = new Thread(()->{
				System.out.println("waiting data....");
				while(!initFlag) {}
				System.out.println("success.....");	
			});

		//新建另外一个线程，对共享变量进行修改
		Thread t2 = new Thread(()-> {
				prepareData();				
		});
		t1.start();
		// 等待一定时间，确保 t1 在 t2 启动之前已经完全启动
		// 否则，可能 t2 先于 t1 启动。则t1 能正常结束
	
		// 
		Thread.sleep(2000);
		t2.start();
		while(true);
	}
	
	private static void prepareData() {
			System.out.println("操作共享变量..");
			initFlag=true;
			System.out.println("修改成功!");
		};
}
```

打印结果如下

```
waiting data....
操作共享变量..
修改成功!
```

第二个线程虽然修改了共享变量的值，但第一个线程仍然检测不到其共享变量在主内存中发生了改变，因此循环会一直进行。

## volatile
如果  initFlag 使用 volatile 修饰