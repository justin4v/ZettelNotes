# 结构
基于栈的特点：
- Hotspot 是**基于栈**的，而不是基于寄存器的；
 - **可移植性更好、指令更短**、实现起来简单；
- 不能随机访问栈中的元素，完成相同功能所需要的指令数更多，需要频繁出入栈。

基于寄存器的特点
- 速度快，有利于程序运行速度的优化；
- 操作数需要显式指定，指令也比较长。


# 字节码指令集概述

-   Java字节码对于虚拟机，就好比汇编语言对于计算机，属于基本执行指令。
-   Java虚拟机的指令由`一个字节长度`的、代表着某种特定操作含义的数字（称为`操作码，Opcode`）以及跟随其后的零至多个代表此操作所需参数（称为`操作数，Operands`）而构成。由于Java虚拟机采用面向操作数栈而不是寄存器的结构，所以大多数的指令都不包含操作数，只有一个操作码。
-   比如 **aload_0** 就是只有操作码没有操作数，而**invokespecial #1** 就是由操作数和操作码构成。
-   由于限制了Java虚拟机操作码的长度为一个字节（0 ~ 255），这意味着指令集的操作码总数不可能超过256条。

## 字节码与数据类型

对于大部分与数据类型相关的字节码指令，`它们的操作码助记符中都有特殊的字符来表明专门为哪种数据类型服务`

-   i代表int类型
-   l代表long
-   s代表short
-   b代表byte
-   c代表char
-   f代表float
-   d代表double

也有一些指令的助记符中没有明确地指明操作类型的字母，如arraylength指令，他没有代表数据类型的特殊字符，但操作数永远只能是一个数组类型的对象。

还有另外一些指令，如无条件跳转指令goto则是与数据类型无关的。

大部分的指令都没有支持整数类型byte、char和short，甚至没有任何指令支持boolean类型。编译器会在编译器或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将boolean和char类型数据零位扩展（Zero-Extend）为相应的int类型数据。与之类似，在处理boolean、byte、short和char类型的数组时，也会转换为使用对应的int类型的字节码指令来处理。因此，大多数对于boolean、byte、short和char类型数据的操作，实际上都是使用相应的int类型作为运算类型（Computational Type）。


# 加载与存储指令

**作用**

加载和存储指令用于将数据从栈帧的局部变量表和操作数栈之间来回传递。

**常用指令**

-   **【局部变量压栈指令】**将一个局部变量加载到操作数栈：xload、xload_（其中x为i、l、f、d、a，n为0到3）
-   **【常量入栈指令】**将一个常量加载到操作数栈：bipush、sipush、ldc、ldc_w、ldc2_w、aconst_null、iconst_ml、iconst、lconst、fconst、dconst
-   **【出栈装入局部变量表指令】**将一个数值从操作数栈存储到局部变量表：xstore、xstore_（其中x为i、l、f、d、a，n为0到3）；xastore（其中x为i、1、f、d、a、b、c、s）

上面所列举的指令助记符中，有一部分是以尖括号结尾的（例如iload）。这些指令助记符实际上代表了一组指令（例如iload代表了iload0、iload1、iload2和iload3这几个指令）。这几组指令都是某个带有一个操作数的通用指令（例如iload）的特殊形式，**对于这若干组特殊指令来说，它们表面上没有操作数，不需要进行取操作数的动作，但操作数都隐含在指令中。**

例如：
```java
iload_0：将局部变量表中索引为0位置上的数据压入操作数栈中。
iload 0：将局部变量表中索引为0位置上的数据压入操作数栈中。
iload 4：将局部变量表中索引为4位置上的数据压入操作数栈中。
```

前两种所表达的意思是相同的，不过iload_0相当于是只有操作码所以只占用1个字节，而iload 0 是操作码和操作数所组成的，而操作数占 2 个字节，所以占用3个字节。

默认最多只有0-3。

![[iload指令.png]]

## 局部变量压栈指令

-   **局部变量压栈指令将给定的局部变量表中的数据压入操作数栈**。
-   这类指令大体可以分为：
    -   xload_<n>（x为i、1、f、d、a，n为0到3）
	-  xload（x为i、1、f、d、a）
    -   说明：在这里，x的取值表示数据类型。
-   指令xload_n表示将第n个局部变量压入操作数栈，比如iload_1、fload_0、aload_0等指令。其中aload_n表示将一个对象引用压栈。
-   指令xload通过指定参数的形式，把局部变量压入操作数栈，当使用这个命令时，表示局部变量的数量可能超过了4个，比如指令iload、fload等。

代码示例
```java
// 1 局部变量入栈命令
public void load(int num,Object obj,long count,boolean flag,short[] arr){
        System.out.println(num);
        System.out.println(obj);
        System.out.println(count);
        System.out.println(flag);
        System.out.println(arr);
}
```
	
	
![[Pasted image 20211012114329.png]]

所对应的局部变量表

![[Pasted image 20211012114345.png]]

	