#SICP #Abstraction-with-Data 

**构造数据抽象 Building Abstractions with Data**
# Compoud Data
- 第 1 章里的所有过程，操作的都是简单的数值数据，而为了模拟复杂的现象，常常需要一些复杂的计算对象。
- 与第1章里的讨论（通过*将过程组合起来形成复合过程，并以此构建各种抽象*）类似，本章重点讨论程序设计语言的另一个关键方面：
- 其提供的*将数据对象组合起来，形成复合数据（compound data）* 的方式。

**为什么在程序设计语言里需要复合数据(compound data)呢**？与需要复合过程的原因一样：
1. 为了**提升设计程序时所处的概念层次（conceptual level）**(联系 [[开发过程中的三个视角#Conceptual 概念|开发中的conceptual 视角]])，构造复合数据，使得能在*比基本数据对象更高的概念层次*上，*处理与数据有关的各种问题*，见 [[#实例]]。；
2. *提高设计的模块性* ；
3. *增强语言的表达能力*。


# 实例
设计一个系统，完成*有理数（rational numbers，整数和分数的统称）* 的算术运算。

**解决**：设想一个运算 `add-rat`：以两个有理数为参数，产生出它们的和。
- *从基本数据出发*，*一个有理数可看作两个整数组成：分子和分母*。
- 可以设计出一个程序：
	- `add-rat`用两个 procedures 实现（一个产生 "和数" 的分子，一个产生 "和数" 的分母）；
	- *有理数用两个整数表示（分子和分母）*；

## 提升概念层次
上述有理数的表示方法（用分子和分母两个整数表示）：
- 最直接最简单的想法。
- 需要始终*明确记住哪个分子与哪个分母对应*。在一个需要执行大量有理数操作的系统里，这种记录会严重地扰乱程序；
- 同时记住分子和分母的对应关系*又与我们的目的（计算有理数和）毫无关系*。

**解决**
1. 将一个分子和一个分母*粘在一起（glue together）*，形成一个**对偶（pair）**——**复合数据对象(compound data object)**；
2. 程序中可以将**有理数(分子和分母)作为一个概念单位(conceptual unit)整体**进行操作；
3. *从离散的数到概念化的有理数整体对象*，提升了概念层次。

## 模块性
复合数据也能进一步提高程序的**模块性(modularity)**。
- 如果直接将有理数本身当作对象操作，就可以把*处理有理数的程序部分（**直接使用有理数的概念进行操作**，如计算有理数连续和、积分等），与有理数如何表示的细节（**有理数概念的具体表现**，如表示为一对整数，基础四则运算表示等）隔离开*。
- 将程序中**数据对象的表示与数据对象的使用相互隔离**的技术非常具有一般性，形成了称为**数据抽象(Data Abstraction)** 的设计方法学。
- 数据抽象技术能使程序*更容易设计、维护和修改*。

## 提高表达能力
复合对象将真正提高程序设计语言的**表达能力(expressive power)**。
- 考虑形成 “*线性组合(linear combination)*” ax＋by；
- 直接的想法是写一个程序 Procedure：接受 a、b、x 和 y 作为参数并返回 ax＋by 的值。
- 如果以数值作为参数，没有困难就能定义出下面的 procedure：
	```scheme
	(define (linear-combination a b x y) 
	  (+ (* a x) (* b y)))
	```

- 但是如果关心的不仅是数，而是*表达某个对象(有理数、复数、多项式或者其他东西)基于 addition 和 multiplication  形成线性组合(linear combinations)的思想*，将其表述为如下 procedure：
	```scheme
	(define (linear-combination a b x y)     
	  (add (mul a x) (mul b y)))
	```

- *`add` 和 `mul` 不是基本过程*`＋`和 `*`，而是**表达了 “加” 和 “乘” 的概念**，能对任何类型的数据执行适当的操作。
- 关键：对于a、b、x和y ，`linear-combination`*只需要知道 Procedure `add` 和 `mul` 能对其执行适当的操作*。
- a、b、x 和 y *是什么、怎样基于更基本的数据表示*，`linear-combination` 无需关心。
- 如果没有直接操作复合数据的能力，就不能在不知道参数具体结构的情况下，作为 Procedure 的参数传递。


# Abstraction Barrier
- 数据抽象如何能在程序的不同部分之间建立起适当的抽象屏障，以克服复杂性；
- 形成复合数据的*关键在于*：程序设计*语言需要提供某种“**黏合剂**(glue)”*，可以把数据对象组合起来，形成更复杂的数据对象。
- 处理复合数据关键性思想：
	1. **闭包(closure)**：**”粘合剂(glue)“ 不仅可用于组合基本数据对象，也同样可用于组合复合数据(compound data)对象**。
	2. 复合数据对象能**成为以混合与匹配(mix-and-match)方式组合程序模块（modules）的方便接口(conventional interfaces)**。
	3. 将通过给出一个利用闭包概念的简单图形语言的方式，阐释有关的思想。


# 符号表达式
 **符号表达式 symbolic expressions**

 - 将探索表示对象集合的各种不同方式，
 - 对于一种给定的数据结构，可以*有许多方式将其表示为简单对象的组合*；
 - 不同表示方式的选择，可能对这些数据相关的计算*过程所需的时间与空间造成重大的影响*。
 - 将在符号微分、集合的表示和信息编码的上下文中研究这些思想。


# 通用型操作
**通用型操作 generic operations**

- 一个**程序的不同部分可能采用不同表示的数据**的问题，引出了实现通用型操作的需要，需要能处理许多不同的数据类型。
- 为了维持模块性，通用型操作要求更强大的抽象屏障。
- **数据导向的程序设计（Data-directed programming）****：允许*孤立地设计每一种数据表示*，而后*用添加的方式将它们组合*（不需要任何修改）。
- 为了展示这一系统设计方法的威力，在本章的最后，将实现一个*多项式符号算术*的程序包，其中多项式的系数可以是整数、有理数、复数，甚至还可以是其他多项式。
