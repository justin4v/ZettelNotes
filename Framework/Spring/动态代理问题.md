#Proxy #Spring 

# 问题
- Spring AOP中*内部方法调用，切面逻辑是不生效*。

```java
//事务注解
@Transactional(rollbackFor = Exception.class)
@Override  
public Result create(Api api) {  
    saveApi(api);    
    return Result.OK();  
}

private void saveApi(Api api){
    //数据库操作
	sqlSave(api);
}
```

- `@Transactional` 原理是动态代理，实际调用是*通过代理类调用*； 
- SQL 操作在 `private` 方法中，调用 saveApi() *实际代码为 `this.saveApi(api)`*，非是通过代理类调用，无法被代理。

# 解决方案
 - 使用 `AopContext#currentProxy`;
 - 在当前类中注入自己，再用自己进行内部调用。
 - 使用中间类进行调用


# 参考
1. [[动态代理]]