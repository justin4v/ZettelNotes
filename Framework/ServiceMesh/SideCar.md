#Service-mesh #Sidecar


在云环境下，技术栈可以是多种多样的。
- 如何将这些异构的服务组件串联起来，成为了服务治理的一个重大课题。

# 问题背景
- 大部分应用和服务都需要实现额外的服务治理功能（如记录日志，监控等），这些功能可以作为单独的组件或服务而存在。
- 如果将*治理功能集成到业务应用中*，就会与业务应用运行在同一个进程中，从而可以有效地共享资源。
- 但也意味着服务治理组件与业务应用之间的*隔离性很弱*，一旦组件出现故障，可能会影响其他组件甚至整个应用程序。
- 服务治理组件需要使用与父应用程序相同的技术栈来实现，因此它们之间有密切的相互依赖性。

# 解决方案
- **将服务治理功能从应用本身剥离出来作为单独进程**；
- 与主应用程序共同放在一台主机（Host）中；
- 但会部署在*各自的进程或容器*中。称为 **Sidecar（边车）模式**。

服务治理功能与主应用程序的部署关系图。
![[SideCar部署示意图.png]]

- sidecar 允许向应用*无侵入添加多种功能*；
- 避免为满足第三方组件需求而向应用添加额外的配置代码。

## Sidecar 模式

- 在软件架构中，`Sidecar` 附加到主应用，或者叫父应用上，以扩展/增强功能特性；
-  `Sidecar` 与主应用是松耦合的。就像是如下图所示的边三轮摩托车那样，将边车（Sidecar）安装在一辆摩托车上，就变成了边三轮摩托车。
- `Sidecar` 服务共享其父应用程序的主机。
- 对于应用程序的每个实例，边车的实例被部署并与其一起托管。
![[边车摩托.png]]

 `Sidecar` 模式优点：
-   通过将服务治理相关功能*抽象到不同的层*降低微服务代码复杂性；
-   在运行时环境和编程语言方面，`Sidecar` *独立于主应用程序*，不需要为每个微服务编写服务治理功能的代码，减少了微服务架构中的代码重复。
-   `Sidecar` 可以访问与主应用程序相同的资源。
-   由于 sidecar 靠近主应用程序，因此*通信没有明显的延迟*。
-   *降低了应用与底层平台的耦合度*。

## Envoy

- `Envoy` 是为云原生应用设计的代理；可
- 以在服务旁运行，以平台无关的方式提供必要的特性；
- 所有到服务的流量都通过 `Envoy` 代理， `Envoy` 扮演的就是 `Sidecar` 的角色。
![[Envoy 示意图.png]]
总的来说：
- 在从*一体化架构向微服务架构*的转型后可以*相对独立、大规模地部署应用*；
- 容器环境中，`Sidecar` 模式可以很好地兼容，帮助*降低微服务架构复杂性*。

# 参考
1. [ServiceMesh的关键：边车模式（sidecar）](https://juejin.cn/post/6875610706079645703)