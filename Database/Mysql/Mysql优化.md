#SQL #Mysql #Optimize

# 架构和查询过程
![[Mysql架构示意.png]]

- 最上一层为客户端，处理：*连接处理、授权认证、安全*等功能。
- 中间层为 MySQL 核心服务：
	- 包括查询*解析、分析、优化、缓存、内置函数*。
	- *跨存储引擎*的功能也在这一层实现：存储过程、触发器、视图等。
- 最下一层为*存储引擎*，负责MySQL中的*数据存储和提取*

## 查询过程
![[mysql查询过程示意.png]]

## 客户端/服务端通信
- 类似“半双工”通信方式；
- 同一时刻，要么客户端向服务端发送数据，要么反过来。不能同时进行。
- 实际开发中，尽量保持查询简单且只返回必需的数据，查询中尽量 *避免使用 SELECT \* 以及加上 LIMIT 限制*。


## 查询缓存
- MySQL将结果缓存在一个引用表（类似于 HashMap）中，通过哈希值索引；
- 哈希值和查询本身、当前要查询的数据库、客户端协议版本号等一些可能影响结果的信息有关；
- 两个查询在任何字符上的不同（例如：空格、注释），都会导致缓存不会命中。
- 如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、mysql库中的系统表，其查询结果都不会被缓存。
- MySQL的查询缓存系统会跟踪查询中涉及的每个表，如果这些表（数据或结构）发生变化，那么和这张表相关的所有缓存数据都将失效。正因为如此，在任何的写操作时，MySQL必须将对应表的所有缓存都设置为失效。如果查询缓存非常大或者碎片很多，这个操作就可能带来很大的系统消耗，甚至导致系统僵死一会儿

最后的忠告是不要轻易打开查询缓存，特别是写密集型应用


# 明确 Select 字段
- 避免使用 '\*' , 只返回需要的字段


# 正确使用索引
- 关联字段尽量使用索引
- 查询字段尽量使用索引
- 值变化不大的字段，索引没有意义，避免建立索引