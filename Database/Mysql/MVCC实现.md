# 简介

- MVCC 使得*数据库读不会对数据加锁*，*普通的 SELECT 请求不会加锁*，提高了数据库的并发处理能力。
- MVCC只在 *REPEATABLE READ* 和 *READ COMMITIED* 两个隔离级别下工作。
- READ UNCOMMITIED *总是读取最新的数据行*，而不是符合当前事务版本的数据行。
- 而 SERIALIZABLE 则*会对所有读取的行都加锁*。


# InnoDB MVCC 实现
Mysql 实现依赖的是 
- *undo log* 
- *read view* 
- 每行数据的两个隐藏列：*事务 ID（DB_TRX_ID，递增）*，*回滚指针（DB_ROLL_PT）*
- 如果没有设置主键还会多添加： *主键（ROW_ID）*
- 查询时需要用*当前事务id和行记录的事务id进行比较*。

保存这两个额外事务编号，使大多数读操作都可以不用加锁。
使得读数据操作很简单，性能很好，并且也能保证只会读取到符合标准的行。不足之处是每行记录都需要额外的存储空间，需要做更多的行检查工作，以及一些额外的维护工作。



### 快照
- **快照**，又叫做**一致性视图**；
- **可重复读**是在事务开始的时候生成一个当前事务**全局性的快照**。
- **读提交**则是每次执行语句的时候都**重新生成快照**。

一个快照能够读到哪些版本数据：
1. 当前事务内的更新，可以读到；
2. 版本未提交，不能读到；
3. 版本已提交，但是却在快照创建后提交的，不能读到；
4. 版本已提交，且是在快照创建前提交的，可以读到；