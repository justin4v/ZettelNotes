#Mysql #Logic-delete #Physical-delete


# join 查询
- left jion 获取左边所有信息，故左表存在逻辑删除字段时，查询需*先排除已经被逻辑删除的数据*，deleted=0 （1表示已删除）

```sql
-- 错误写法
SELECT a.id,b.id
FROM A a LEFT JOIN B b 
ON a.id=b.a_id WHERE a.deleted=0 AND b.deleted=0
 
 
--正确写法
SELECT a.id,b.id
FROM 
	(SELECT id FROM A WHERE deleted=0) a 
LEFT JOIN
	(SELECT id,a_id FROM B WHERE deleted=0) b 
ON c.id=b.a_id 
```


# Mysql 数据恢复
## binlog 日志
- binlog 是二进制日志，记录：
	- 数据库表结构变更 DDL（例如CREATE、ALTER TABLE…）；
	- 表数据修改 DML（INSERT、UPDATE、DELETE…）；
- 用 binlog 恢复数据：
	- 通过 binlog 找到 DML 操作；
	- 按顺序执行除去删除数据的 SQL 语句外的其它语句，可将数据恢复。

示意图如下：
![[binlog恢复数据库数据示意.png]]

  
- 要停掉数据库；
- 假如数据量大的话，难以筛选恢复数据的 sql；

## 数据库延时同步节点

-   配置一个同步数据的数据库；
-   同步时间，要延时：比如 1 小时同步一次
-   当出现问题的时候，只要在这个延时时间内，都还可以恢复出一定的数据

所以，综上，可以认识到，数据删除之后的恢复是要付出很大代价的，而且还存在不可恢复的风险。所以出于安全考虑，生产环境数据库应当尽可能禁止`物理删除`。

# 逻辑删除会带来什么问题？



# 参考
1. [数据库，逻辑删还是物理删？](https://juejin.cn/post/6946577362301485063)
2. [实现数据逻辑删除的一种方案](https://www.cnblogs.com/54chensongxia/p/14247966.html)