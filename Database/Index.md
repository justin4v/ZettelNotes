#Todo 

索引（index）是在*存储引擎（storage engine）层面实现*，而不是server层面

# MySQL索引分类
## 数据结构角度
- B+ 树索引
- Hash 索引
- Full-Text 全文索引
- R-Tree 索引

## 物理存储角度
- *聚集索引（clustered index）*
- *非聚集索引（non-clustered index）*，也叫辅助索引（secondary index）
	- 聚集索引和非聚集索引都是 B+ 树结构
    

## 逻辑角度
- *主键索引*：主键索引是一种特殊的唯一索引，不允许有空值
- *普通索引或者单列索引*：每个索引只包含单个列，一个表可以有多个单列索引
- *多列索引（复合索引、联合索引）*：复合索引指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。使用复合索引时遵循最左前缀集合
- *唯一索引或者非唯一索引*
- *空间索引*：空间索引是对空间数据类型的字段建立的索引；
	- MYSQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING、POLYGON。
	- 空间索引只能在存储引擎为 MYISAM 的表中创建。


## B-Tree
- B-Tree 是为磁盘等外存储设备设计的一种*平衡查找树*。
- 系统从磁盘读取数据到内存时以*磁盘块（block）为基本单位*，位于同一个磁盘块中的数据会*被一次性读取出来*，而不是需要什么取什么。

InnoDB 存储引擎中有*页（Page）* 的概念，*页是磁盘管理的最小单位*。
InnoDB 存储引擎中默认每个页的大小为16KB，可通过参数 `innodb_page_size` 将页的大小设置为 4K、8K、16K，在 MySQL 中可通过如下命令查看页的大小：`show variables like 'innodb_page_size';`

而系统一个磁盘块的存储空间往往没有这么大，因此 InnoDB 每次申请磁盘空间时都会是若干地址连续磁盘块来达到页的大小 16KB。InnoDB 在把磁盘数据读入到磁盘时会以页为基本单位，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O次数，提高查询效率。

B-Tree 结构的数据可以让系统高效的找到数据所在的磁盘块。为了描述 B-Tree，首先定义一条记录为一个二元组[key, data] ，key为记录的键值，对应表中的主键值，data 为一行记录中除主键外的数据。对于不同的记录，key值互不相同。

一棵m阶的B-Tree有如下特性： 

1.  每个节点最多有m个孩子 
2.  除了根节点和叶子节点外，其它每个节点至少有Ceil(m/2)个孩子。
3.  若根节点不是叶子节点，则至少有2个孩子 
4.  所有叶子节点都在同一层，且不包含其它关键字信息 
5.  每个非终端节点包含n个关键字信息（P0,P1,…Pn, k1,…kn） 
6.  关键字的个数n满足：ceil(m/2)-1 <= n <= m-1 
7.  ki(i=1,…n)为关键字，且关键字升序排序
8.  Pi(i=1,…n)为指向子树根节点的指针。P(i-1)指向的子树的所有节点关键字均小于ki，但都大于k(i-1)

B-Tree 中的每个节点根据实际情况可以包含大量的关键字信息和分支，如下图所示为一个 3 阶的 B-Tree：

![索引](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/14/1734bff356b40f0d~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)

每个节点占用一个盘块的磁盘空间，一个节点上有两个升序排序的关键字和三个指向子树根节点的指针，指针存储的是子节点所在磁盘块的地址。两个关键词划分成的三个范围域对应三个指针指向的子树的数据的范围域。以根节点为例，关键字为17和35，P1指针指向的子树的数据范围为小于17，P2指针指向的子树的数据范围为17~35，P3指针指向的子树的数据范围为大于35。

模拟查找关键字29的过程：

1.  根据根节点找到磁盘块1，读入内存。【磁盘I/O操作第1次】
2.  比较关键字29在区间（17,35），找到磁盘块1的指针P2。
3.  根据P2指针找到磁盘块3，读入内存。【磁盘I/O操作第2次】
4.  比较关键字29在区间（26,30），找到磁盘块3的指针P2。
5.  根据P2指针找到磁盘块8，读入内存。【磁盘I/O操作第3次】
6.  在磁盘块8中的关键字列表中找到关键字29。

分析上面过程，发现需要3次磁盘I/O操作，和3次内存查找操作。由于内存中的关键字是一个有序表结构，可以利用二分法查找提高效率。而3次磁盘I/O操作是影响整个B-Tree查找效率的决定因素。B-Tree相对于AVLTree缩减了节点个数，使每次磁盘I/O取到内存的数据都发挥了作用，从而提高了查询效率。

  
作者：贾不假  
链接：https://juejin.cn/post/6850037271233331208  
来源：稀土掘金  
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。